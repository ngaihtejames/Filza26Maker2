name: Filza26Maker Auto Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 🧩 Checkout repository
        uses: actions/checkout@v4

      - name: ⚙️ Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip zip wget curl tar p7zip-full

      - name: 🧠 Info
        run: |
          echo "-----------------------------------------------------------"
          echo "📦 Filza26Maker Auto Build"
          echo "This workflow repackages the official Filza tweak (.deb)"
          echo "into a jailed .ipa using your Filza26Maker.sh script."
          echo "It does NOT inject or modify tweaks — only repackages them."
          echo "-----------------------------------------------------------"

      - name: 🪄 Make script executable
        run: chmod +x ./Filza26Maker.sh

      - name: 🚀 Run Filza26Maker
        run: |
          echo "Starting Filza26Maker build..."
          ./Filza26Maker.sh || echo "⚠️ Script exited with a warning or finished early."
          echo "Build script finished."

      - name: 📂 Detect and zip output
        run: |
          mkdir -p final_output
          echo "Collecting build outputs..."

          # Copy typical output files or folders
          find . -maxdepth 2 -type f \( -name "*.ipa" -o -name "*.zip" \) -exec cp {} final_output/ \; || true
          find . -maxdepth 2 -type d \( -name "output" -o -name "build" -o -name "dist" -o -name "Payload" \) -exec cp -r {} final_output/ \; || true

          # If nothing found, zip entire workspace
          if [ -z "$(ls -A final_output)" ]; then
            echo "No specific outputs found — zipping full workspace."
            zip -r Filza26_AllFiles.zip .
            mv Filza26_AllFiles.zip final_output/
          fi

          # Final zip for upload
          zip -r Filza26_Output.zip final_output

          echo "✅ Build complete. Output packaged as Filza26_Output.zip"

      - name: 📤 Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: Filza26_output
          path: final_output/Filza26_Output.zip
